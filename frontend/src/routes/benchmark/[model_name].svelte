<script lang="ts">
	import { onMount } from 'svelte';
	import { page } from '$app/stores';
	import { connectToSocket, sendMessage } from '$lib/websocket';
	import { goto } from '$app/navigation';
	import { remotehostname } from '../../env';

	// @ts-ignore
	var websocket: WebSocket;
	var requestID: number;
	onMount(() => {
		websocket = new WebSocket(
			`ws://${remotehostname}/ws/ml_models/benchmark/${$page.params.model_name}/`
		);
		// @ts-ignore
		websocket.onclose =(() => {
			goto('/errors/404')});
		requestID = new Date().getTime();
	});
	function benchmark() {
		sendMessage(websocket, {
			request_id: requestID,
			action: 'start_session',
			device_type: 'cpu'
		});
	}
</script>

<svelte:head>
	<title>Home</title>
	<meta name="description" content="Svelte demo app" />
</svelte:head>

<section class="text-center mt-5">
	<h1>Benchmark</h1>
	<p>
		Forked.ai provides a streamlined payment interface between customers and your model. You can
		choose between subscription based, token based or free charging models.
	</p>
	<p>
		<b>Token based:</b>
		A pay as you go setup where customers top up there account with tokens and spend as and when they
		need. You decide the tokens now for example 1 token could be a single image generated by your model
		or it could be 20 seconds of video generated by your model. You provide an example input and the
		number of seconds of compute is measured for that particular input. The cost per second of compute
		is presented and you add the additional amount you wish to earn per token bought.
	</p>

	<button class="btn btn-primary mt-5" on:click={benchmark}> Benchmark model setup </button>
	<br />
	<button class="btn btn-accent mt-5"> Benchmark CPU inference </button>
	<br />
	<button class="btn btn-secondary mt-5"> Benchmark GPU inference </button>
</section>

<style>
</style>
